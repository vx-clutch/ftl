#!/bin/bash

RESET="\033[0m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"	
RED="\033[0;31m"

function find_cc {
  echo "====> Checking for CC"
  CCs="gcc"
  for cc in $CCs; do
    if command -v $cc 2>&1 >/dev/null
    then
      echo -e "  ${GREEN}found $cc${RESET}"
      foundCC=true
      return
    fi
  done
  echo "  failure to configure: cannot find a C compiler in user path."
  echo "  If you with to use a C compiler other than gcc, modify the CC variable in the Makefile"
}

exists() {
    echo -e "${YELLOW}===> Checking for $1${RESET}"
    if ! command -v $1 2>&1 >/dev/null
    then
        echo -e "  ${RED}failure to configure: cannot find $1 in user path.${RESET}"
        action=true
    else
        echo -e "  ${GREEN}found $1${RESET}"
    
    fi
}

depends_on="nasm ld go"
action=false
foundCC=false

find_cc

echo "====> Checking for other dependencies"

for cmd in $depends_on; do
  exists "$cmd"
done

if $action
then
  echo "Install the needed binarys before continuing to compilation."
fi

if ! $foundCC
then
    echo "If you with to use a C compiler other than gcc or clang, modify the CC variable in the Makefile"
fi